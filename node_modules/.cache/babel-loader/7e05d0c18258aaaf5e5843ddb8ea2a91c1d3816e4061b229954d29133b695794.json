{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2018 Google LLC\n *\n * Distributed under MIT license.\n * See file LICENSE for detail or copy at https://opensource.org/licenses/MIT\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst path = require(\"path\");\nconst protobuf = require(\"protobufjs\");\nconst walk = require(\"walkdir\");\nlet COMMON_PROTO_FILES;\nclass GoogleProtoFilesRoot extends protobuf.Root {\n  constructor(options) {\n    super(options);\n  }\n  // Caches and returns an array of the local common/google core proto files\n  // exist on disk.\n  static getCommonProtoFiles() {\n    const commonProtoDirs = [\n    // This list of directories is defined here:\n    // https://github.com/googleapis/googleapis/blob/master/gapic/packaging/common_protos.yaml\n    'api', path.join('logging', 'type'), 'longrunning', 'protobuf',\n    // on.\n    'rpc', 'type'].map(dir => path.join(__dirname, '../../', 'google', dir));\n    if (!COMMON_PROTO_FILES) {\n      COMMON_PROTO_FILES = commonProtoDirs.map(dir => {\n        return walk.sync(dir).filter(f => path.extname(f) === '.proto').map(path.normalize);\n      }).reduce((a, c) => a.concat(c), []);\n    }\n    return COMMON_PROTO_FILES;\n  }\n  // Causes the loading of an included proto to check if it is a common\n  // proto. If it is a common proto, use the google-proto-files proto.\n  resolvePath(_, includePath, alreadyNormalized) {\n    includePath = path.normalize(includePath);\n    // Fully qualified paths don't need to be resolved.\n    if (path.isAbsolute(includePath)) {\n      return includePath;\n    }\n    const fullIncludePath = path.join(__dirname, path.relative(__dirname, includePath));\n    const commonProtoFiles = GoogleProtoFilesRoot.getCommonProtoFiles();\n    if (commonProtoFiles.indexOf(fullIncludePath) > -1) {\n      return fullIncludePath;\n    }\n    return protobuf.util.path.resolve(_, includePath, alreadyNormalized);\n  }\n}\nexports.GoogleProtoFilesRoot = GoogleProtoFilesRoot;\nfunction loadSync(filename, options) {\n  const root = new GoogleProtoFilesRoot();\n  return root.loadSync(filename, options);\n}\nexports.loadSync = loadSync;\nfunction load(filename, options) {\n  const root = new GoogleProtoFilesRoot();\n  return root.load(filename, options);\n}\nexports.load = load;","map":{"version":3,"names":["path","require","protobuf","walk","COMMON_PROTO_FILES","GoogleProtoFilesRoot","Root","constructor","options","getCommonProtoFiles","commonProtoDirs","join","map","dir","__dirname","sync","filter","f","extname","normalize","reduce","a","c","concat","resolvePath","_","includePath","alreadyNormalized","isAbsolute","fullIncludePath","relative","commonProtoFiles","indexOf","util","resolve","exports","loadSync","filename","root","load"],"sources":["../../src/load.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;AAOA,MAAAA,IAAA,GAAAC,OAAA;AACA,MAAAC,QAAA,GAAAD,OAAA;AACA,MAAAE,IAAA,GAAAF,OAAA;AAEA,IAAIG,kBAA4B;AAOhC,MAAaC,oBAAqB,SAAQH,QAAQ,CAACI,IAAI;EACrDC,YAAYC,OAAqC;IAC/C,KAAK,CAACA,OAAO,CAAC;EAChB;EAEA;EACA;EACA,OAAOC,mBAAmBA,CAAA;IACxB,MAAMC,eAAe,GAAG;IACtB;IACA;IACA,KAAK,EACLV,IAAI,CAACW,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC,EAC5B,aAAa,EACb,UAAU;IACG;IACb,KAAK,EACL,MAAM,CACP,CAACC,GAAG,CAACC,GAAG,IAAIb,IAAI,CAACW,IAAI,CAACG,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAED,GAAG,CAAC,CAAC;IAE3D,IAAI,CAACT,kBAAkB,EAAE;MACvBA,kBAAkB,GAAGM,eAAe,CACVE,GAAG,CAACC,GAAG,IAAG;QACT,OAAQV,IAAI,CAACY,IAAI,CAACF,GAAG,CAAc,CAC9BG,MAAM,CAACC,CAAC,IAAIjB,IAAI,CAACkB,OAAO,CAACD,CAAC,CAAC,KAAK,QAAQ,CAAC,CACzCL,GAAG,CAACZ,IAAI,CAACmB,SAAS,CAAC;MAC1B,CAAC,CAAC,CACDC,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACE,MAAM,CAACD,CAAC,CAAC,EAAE,EAAE,CAAC;;IAG7D,OAAOlB,kBAAkB;EAC3B;EAEA;EACA;EACAoB,WAAWA,CAACC,CAAS,EAAEC,WAAmB,EAAEC,iBAA2B;IACrED,WAAW,GAAG1B,IAAI,CAACmB,SAAS,CAACO,WAAW,CAAC;IAEzC;IACA,IAAI1B,IAAI,CAAC4B,UAAU,CAACF,WAAW,CAAC,EAAE;MAChC,OAAOA,WAAW;;IAGpB,MAAMG,eAAe,GACjB7B,IAAI,CAACW,IAAI,CAACG,SAAS,EAAEd,IAAI,CAAC8B,QAAQ,CAAChB,SAAS,EAAEY,WAAW,CAAC,CAAC;IAC/D,MAAMK,gBAAgB,GAAG1B,oBAAoB,CAACI,mBAAmB,EAAE;IAEnE,IAAIsB,gBAAgB,CAACC,OAAO,CAACH,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE;MAClD,OAAOA,eAAe;;IAGxB,OAAO3B,QAAQ,CAAC+B,IAAI,CAACjC,IAAI,CAACkC,OAAO,CAACT,CAAC,EAAEC,WAAW,EAAEC,iBAAiB,CAAC;EACtE;;AApDFQ,OAAA,CAAA9B,oBAAA,GAAAA,oBAAA;AAuDA,SAAgB+B,QAAQA,CAACC,QAAgB,EAAE7B,OAAgC;EACzE,MAAM8B,IAAI,GAAG,IAAIjC,oBAAoB,EAAE;EACvC,OAAOiC,IAAI,CAACF,QAAQ,CAACC,QAAQ,EAAE7B,OAAO,CAAC;AACzC;AAHA2B,OAAA,CAAAC,QAAA,GAAAA,QAAA;AAKA,SAAgBG,IAAIA,CAACF,QAAgB,EAAE7B,OAAgC;EACrE,MAAM8B,IAAI,GAAG,IAAIjC,oBAAoB,EAAE;EACvC,OAAOiC,IAAI,CAACC,IAAI,CAACF,QAAQ,EAAE7B,OAAO,CAAC;AACrC;AAHA2B,OAAA,CAAAI,IAAA,GAAAA,IAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}