/*
 Highcharts JS v11.1.0 (2023-09-05)

 Sankey diagram module

 (c) 2010-2021 Torstein Honsi

 License: www.highcharts.com/license
*/
'use strict';(function(b){"object"===typeof module&&module.exports?(b["default"]=b,module.exports=b):"function"===typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(n){b(n);b.Highcharts=n;return b}):b("undefined"!==typeof Highcharts?Highcharts:void 0)})(function(b){function n(b,g,p,k){b.hasOwnProperty(g)||(b[g]=k.apply(null,p),"function"===typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:g,module:b[g]}})))}b=b?b._modules:
{};n(b,"Series/NodesComposition.js",[b["Core/Series/SeriesRegistry.js"],b["Core/Utilities.js"]],function(b,g){const {series:{prototype:p,prototype:{pointClass:{prototype:k}}}}=b,{defined:B,extend:z,find:c,merge:r,pick:e}=g;var a;(function(a){function f(){this.data=[].concat(this.points||[],this.nodes);return p.destroy.apply(this,arguments)}function b(){this.nodes&&(this.nodes.forEach(a=>{a.destroy()}),this.nodes.length=0);p.setData.apply(this,arguments)}function D(a){const f=arguments,d=this.isNode?
this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==a&&d.forEach(a=>{a&&a.series&&(k.setState.apply(a,f),a.isNode||(a.fromNode.graphic&&k.setState.apply(a.fromNode,f),a.toNode&&a.toNode.graphic&&k.setState.apply(a.toNode,f)))});k.setState.apply(this,f)}function m(a,f,d,c){const b=this.series.options.nodes,h=this.series.options.data,u=h&&h.length||0,A=h&&h[this.index];k.update.call(this,a,this.isNode?!1:f,d,c);this.isNode&&(a=(b||[]).reduce((h,a,u)=>this.id===a.id?u:h,-1),c=
r(b&&b[a]||{},h&&h[this.index]||{}),h&&(A?h[this.index]=A:h.length=u),b?0<=a?b[a]=c:b.push(c):this.series.options.nodes=[c],e(f,!0)&&this.series.chart.redraw(d))}const v=[];a.compose=function(a,c){g.pushUnique(v,a)&&(a=a.prototype,a.setNodeState=D,a.setState=D,a.update=m);g.pushUnique(v,c)&&(a=c.prototype,a.destroy=f,a.setData=b);return c};a.createNode=function(a){const f=this.pointClass;var d=(a,h)=>c(a,a=>a.id===h);let b=d(this.nodes,a);if(!b){d=this.options.nodes&&d(this.options.nodes,a);const c=
(new f).init(this,z({className:"highcharts-node",isNode:!0,id:a,y:1},d));c.linksTo=[];c.linksFrom=[];c.getSum=function(){let a=0,u=0;c.linksTo.forEach(h=>{a+=h.weight||0});c.linksFrom.forEach(a=>{u+=a.weight||0});return Math.max(a,u)};c.offset=function(a,u){let h=0;for(let d=0;d<c[u].length;d++){if(c[u][d]===a)return h;h+=c[u][d].weight}};c.hasShape=function(){let a=0;c.linksTo.forEach(h=>{h.outgoing&&a++});return!c.linksTo.length||a!==c.linksTo.length};c.index=this.nodes.push(c)-1;b=c}b.formatPrefix=
"node";b.name=b.name||b.options.id||"";b.mass=e(b.options.mass,b.options.marker&&b.options.marker.radius,this.options.marker&&this.options.marker.radius,4);return b};a.destroy=f;a.generatePoints=function(){const a=this.chart,c={};p.generatePoints.call(this);this.nodes||(this.nodes=[]);this.colorCounter=0;this.nodes.forEach(a=>{a.linksFrom.length=0;a.linksTo.length=0;a.level=a.options.level});this.points.forEach(d=>{B(d.from)&&(c[d.from]||(c[d.from]=this.createNode(d.from)),c[d.from].linksFrom.push(d),
d.fromNode=c[d.from],a.styledMode?d.colorIndex=e(d.options.colorIndex,c[d.from].colorIndex):d.color=d.options.color||c[d.from].color);B(d.to)&&(c[d.to]||(c[d.to]=this.createNode(d.to)),c[d.to].linksTo.push(d),d.toNode=c[d.to]);d.name=d.name||d.id},this);this.nodeLookup=c};a.setNodeState=D;a.updateNode=m})(a||(a={}));return a});n(b,"Series/Sankey/SankeyPoint.js",[b["Core/Series/Point.js"],b["Core/Series/SeriesRegistry.js"],b["Core/Utilities.js"]],function(b,g,p){({seriesTypes:{column:g}}=g);const {defined:k}=
p;class B extends g.prototype.pointClass{constructor(){super(...arguments);this.toNode=this.series=this.options=this.nodeY=this.nodeX=this.mass=this.linksTo=this.linksFrom=this.linkColorMode=this.linkBase=this.level=this.fromNode=this.className=void 0}applyOptions(g,c){b.prototype.applyOptions.call(this,g,c);k(this.options.level)&&(this.options.column=this.column=this.options.level);return this}getClassName(){return(this.isNode?"highcharts-node ":"highcharts-link ")+b.prototype.getClassName.call(this)}getFromNode(){let b=
-1,c;for(let r=0;r<this.linksTo.length;r++){const e=this.linksTo[r];e.fromNode.column>b&&e.fromNode!==this&&(c=e.fromNode,b=c.column)}return{fromNode:c,fromColumn:b}}setNodeColumn(){k(this.options.column)||(this.column=0===this.linksTo.length?0:this.getFromNode().fromColumn+1)}isValid(){return this.isNode||"number"===typeof this.weight}}return B});n(b,"Series/Sankey/SankeySeriesDefaults.js",[],function(){"";return{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",
crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkColorMode:"from",linkOpacity:.5,opacity:1,minLinkWidth:0,nodeAlignment:"center",nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} \u2192 {point.toNode.name}: <b>{point.weight}</b><br/>",
nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}});n(b,"Series/Sankey/SankeyColumnComposition.js",[b["Core/Utilities.js"]],function(b){const {defined:g,relativeLength:p}=b;var k;(function(b){b.compose=function(c,b){c.sankeyColumn=new k(c,b);return c};class k{constructor(c,b){this.points=c;this.series=b}getTranslationFactor(c){const b=this.points,e=b.slice(),a=c.options.minLinkWidth||0;let f=0,q,l=(c.chart.plotSizeY||0)-(c.options.borderWidth||0)-(b.length-1)*c.nodePadding;for(;b.length;){f=l/
b.sankeyColumn.sum();c=!1;for(q=b.length;q--;)b[q].getSum()*f<a&&(b.splice(q,1),l=Math.max(0,l-a),c=!0);if(!c)break}b.length=0;e.forEach(a=>{b.push(a)});return f}top(b){const c=this.series,e=c.nodePadding,a=this.points.reduce(function(a,q){0<a&&(a+=e);q=Math.max(q.getSum()*b,c.options.minLinkWidth||0);return a+q},0);return{top:0,center:.5,bottom:1}[c.options.nodeAlignment||"center"]*((c.chart.plotSizeY||0)-a)}left(b){const c=this.series,e=c.chart,a=c.options.equalNodes,f=e.inverted?e.plotHeight:e.plotWidth,
q=c.nodePadding,l=this.points.reduce(function(e,l){0<e&&(e+=q);l=a?f/l.series.nodes.length-q:Math.max(l.getSum()*b,c.options.minLinkWidth||0);return e+l},0);return((e.plotSizeX||0)-Math.round(l))/2}sum(){return this.points.reduce(function(b,g){return b+g.getSum()},0)}offset(b,k){const c=this.points,a=this.series,f=a.nodePadding;let q=0;if(a.is("organization")&&b.hangsFrom)return{absoluteTop:b.hangsFrom.nodeY};for(let e=0;e<c.length;e++){var l=c[e].getSum();const m=Math.max(l*k,a.options.minLinkWidth||
0),v=b.options[a.chart.inverted?"offsetHorizontal":"offsetVertical"],w=b.options.offset||0;l=l?m+f:0;if(c[e]===b)return{relativeTop:q+(g(v)?p(v,m):p(w,l))};q+=l}}}b.SankeyColumnAdditions=k})(k||(k={}));return k});n(b,"Series/TreeUtilities.js",[b["Core/Color/Color.js"],b["Core/Utilities.js"]],function(b,g){function p(a,b){var c=b.before;const f=b.idRoot,g=b.mapIdToNode[f],m=b.points[a.i],v=m&&m.options||{},w=[];let y=0;a.levelDynamic=a.level-(!1!==b.levelIsConstant?0:g.level);a.name=e(m&&m.name,"");
a.visible=f===a.id||!0===b.visible;"function"===typeof c&&(a=c(a,b));a.children.forEach((c,f)=>{const d=k({},b);k(d,{index:f,siblings:a.children.length,visible:a.visible});c=p(c,d);w.push(c);c.visible&&(y+=c.val)});c=e(v.value,y);a.visible=0<=c&&(0<y||a.visible);a.children=w;a.childrenTotal=y;a.isLeaf=a.visible&&!y;a.val=c;return a}const {extend:k,isArray:n,isNumber:z,isObject:c,merge:r,pick:e}=g;return{getColor:function(a,c){const f=c.index;var g=c.mapOptionsToLevel;const k=c.parentColor,m=c.parentColorIndex,
v=c.series;var w=c.colors;const p=c.siblings;var d=v.points,n=v.chart.options.chart;let r;var h;let u;if(a){d=d[a.i];a=g[a.level]||{};if(g=d&&a.colorByPoint){r=d.index%(w?w.length:n.colorCount);var A=w&&w[r]}if(!v.chart.styledMode){w=d&&d.options.color;n=a&&a.color;if(h=k)h=(h=a&&a.colorVariation)&&"brightness"===h.key&&f&&p?b.parse(k).brighten(f/p*h.to).get():k;h=e(w,n,A,h,v.color)}u=e(d&&d.options.colorIndex,a&&a.colorIndex,r,m,c.colorIndex)}return{color:h,colorIndex:u}},getLevelOptions:function(a){let b=
{},g,k,p;if(c(a)){p=z(a.from)?a.from:1;var m=a.levels;k={};g=c(a.defaults)?a.defaults:{};n(m)&&(k=m.reduce((a,b)=>{let f,d;c(b)&&z(b.level)&&(d=r({},b),f=e(d.levelIsConstant,g.levelIsConstant),delete d.levelIsConstant,delete d.level,b=b.level+(f?0:p-1),c(a[b])?r(!0,a[b],d):a[b]=d);return a},{}));m=z(a.to)?a.to:1;for(a=0;a<=m;a++)b[a]=r({},g,c(k[a])?k[a]:{})}return b},setTreeValues:p,updateRootId:function(a){if(c(a)){var b=c(a.options)?a.options:{};b=e(a.rootNode,b.rootId,"");c(a.userOptions)&&(a.userOptions.rootId=
b);a.rootNode=b}return b}}});n(b,"Series/Sankey/SankeySeries.js",[b["Core/Globals.js"],b["Series/NodesComposition.js"],b["Series/Sankey/SankeyPoint.js"],b["Series/Sankey/SankeySeriesDefaults.js"],b["Core/Series/SeriesRegistry.js"],b["Series/Sankey/SankeyColumnComposition.js"],b["Core/Color/Color.js"],b["Series/TreeUtilities.js"],b["Core/Utilities.js"]],function(b,g,p,k,n,z,c,r,e){const {series:a,seriesTypes:{column:f}}=n,{parse:q}=c,{getLevelOptions:l}=r,{clamp:D,extend:m,isObject:v,merge:w,pick:y,
relativeLength:d,stableSort:B}=e;class C extends f{constructor(){super(...arguments);this.translationFactor=this.points=this.options=this.nodeWidth=this.nodes=this.nodePadding=this.nodeLookup=this.group=this.data=this.colDistance=void 0}static getDLOptions(a){const b=v(a.optionsPoint)?a.optionsPoint.dataLabels:{};a=v(a.level)?a.level.dataLabels:{};return w({style:{}},a,b)}createNodeColumns(){const a=[];this.nodes.forEach(function(b){b.setNodeColumn();a[b.column]||(a[b.column]=z.compose([],this));
a[b.column].push(b)},this);for(let b=0;b<a.length;b++)"undefined"===typeof a[b]&&(a[b]=z.compose([],this));return a}order(a,b){const c=this;"undefined"===typeof a.level&&(a.level=b,a.linksFrom.forEach(function(a){a.toNode&&c.order(a.toNode,b+1)}))}generatePoints(){g.generatePoints.apply(this,arguments);const a=this;this.orderNodes&&(this.nodes.filter(function(a){return 0===a.linksTo.length}).forEach(function(b){a.order(b,0)}),B(this.nodes,function(a,b){return a.level-b.level}))}getNodePadding(){let a=
this.options.nodePadding||0;if(this.nodeColumns){const b=this.nodeColumns.reduce((a,b)=>Math.max(a,b.length),0);b*a>this.chart.plotSizeY&&(a=this.chart.plotSizeY/b)}return a}hasData(){return!!this.processedXData.length}pointAttribs(a,b){if(!a)return{};const h=this,d=h.mapOptionsToLevel[(a.isNode?a.level:a.fromNode.level)||0]||{},f=a.options,u=d.states&&d.states[b||""]||{};b=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce(function(a,b){a[b]=y(u[b],f[b],d[b],h.options[b]);
return a},{});const e=y(u.color,f.color,b.colorByPoint?a.color:d.color);return a.isNode?{fill:e,stroke:b.borderColor,"stroke-width":b.borderWidth,opacity:b.opacity}:{fill:c.parse(e).setOpacity(b.linkOpacity).get()}}drawTracker(){f.prototype.drawTracker.call(this,this.points);f.prototype.drawTracker.call(this,this.nodes)}drawPoints(){f.prototype.drawPoints.call(this,this.points);f.prototype.drawPoints.call(this,this.nodes)}drawDataLabels(){f.prototype.drawDataLabels.call(this,this.points);f.prototype.drawDataLabels.call(this,
this.nodes)}translate(){this.processedXData||this.processData();this.generatePoints();this.nodeColumns=this.createNodeColumns();this.nodeWidth=d(this.options.nodeWidth,this.chart.plotSizeX);const a=this,b=this.chart,c=this.options,f=this.nodeWidth,e=this.nodeColumns;this.nodePadding=this.getNodePadding();this.translationFactor=e.reduce((b,c)=>Math.min(b,c.sankeyColumn.getTranslationFactor(a)),Infinity);this.colDistance=(b.plotSizeX-f-c.borderWidth)/Math.max(1,e.length-1);a.mapOptionsToLevel=l({from:1,
levels:c.levels,to:e.length-1,defaults:{borderColor:c.borderColor,borderRadius:c.borderRadius,borderWidth:c.borderWidth,color:a.color,colorByPoint:c.colorByPoint,levelIsConstant:!0,linkColor:c.linkColor,linkLineWidth:c.linkLineWidth,linkOpacity:c.linkOpacity,states:c.states}});e.forEach(function(b){b.forEach(function(c){a.translateNode(c,b)})},this);this.nodes.forEach(function(b){b.linksFrom.forEach(function(b){(b.weight||b.isNull)&&b.to&&(a.translateLink(b),b.allowShadow=!1)})})}translateLink(a){var b=
(b,c)=>{c=b.offset(a,c)*e;return Math.min(b.nodeY+c,b.nodeY+(b.shapeArgs&&b.shapeArgs.height||0)-t)},c=a.fromNode,d=a.toNode;const h=this.chart,{inverted:f}=h,e=this.translationFactor;var g=this.options;const k=y(a.linkColorMode,g.linkColorMode);var p=(h.inverted?-this.colDistance:this.colDistance)*g.curveFactor;g=c.nodeX;const x=d.nodeX;var n=a.outgoing;let t=Math.max(a.weight*e,this.options.minLinkWidth),m=b(c,"linksFrom");b=b(d,"linksTo");let l=this.nodeWidth;var r=x>g+l;h.inverted&&(m=h.plotSizeY-
m,b=(h.plotSizeY||0)-b,l=-l,t=-t,r=g>x);a.shapeType="path";a.linkBase=[m,m+t,b,b+t];if(r&&"number"===typeof b)a.shapeArgs={d:[["M",g+l,m],["C",g+l+p,m,x-p,b,x,b],["L",x+(n?l:0),b+t/2],["L",x,b+t],["C",x-p,b+t,g+l+p,m+t,g+l,m+t],["Z"]]};else if("number"===typeof b){p=x-20-t;n=x-20;r=g+l;const c=r+20,d=c+t,f=m,e=m+t,k=e+20,u=k+(h.plotHeight-m-t),q=u+20,v=q+t,w=b,A=w+t,y=A+20,z=q+.7*t,E=x-.7*t,F=r+.7*t;a.shapeArgs={d:[["M",r,f],["C",F,f,d,e-.7*t,d,k],["L",d,u],["C",d,z,F,v,r,v],["L",x,v],["C",E,v,p,
z,p,u],["L",p,y],["C",p,A-.7*t,E,w,x,w],["L",x,A],["C",n,A,n,A,n,y],["L",n,u],["C",n,q,n,q,x,q],["L",r,q],["C",c,q,c,q,c,u],["L",c,k],["C",c,e,c,e,r,e],["Z"]]}}a.dlBox={x:g+(x-g+l)/2,y:m+(b-m)/2,height:t,width:0};a.tooltipPos=h.inverted?[h.plotSizeY-a.dlBox.y-t/2,h.plotSizeX-a.dlBox.x]:[a.dlBox.x,a.dlBox.y+t/2];a.y=a.plotY=1;a.x=a.plotX=1;a.options.color||("from"===k?a.color=c.color:"to"===k?a.color=d.color:"gradient"===k&&(c=q(c.color).get(),d=q(d.color).get(),a.color={linearGradient:{x1:1,x2:0,
y1:0,y2:0},stops:[[0,f?c:d],[1,f?d:c]]}))}translateNode(a,b){var c=this.translationFactor;const e=this.chart,f=this.options,{borderRadius:g,borderWidth:h=0}=f;var k=a.getSum();const m=Math.max(Math.round(k*c),this.options.minLinkWidth),p=Math.round(this.nodeWidth);var l=Math.round(h)%2/2,n=b.sankeyColumn.offset(a,c);b=Math.floor(y(n.absoluteTop,b.sankeyColumn.top(c)+n.relativeTop))+l;l=Math.floor(this.colDistance*a.column+h/2)+d(a.options[e.inverted?"offsetVertical":"offsetHorizontal"]||0,p)+l;l=
e.inverted?e.plotSizeX-l:l;if(a.sum=k){a.shapeType="roundedRect";a.nodeX=l;a.nodeY=b;k=l;c=b;n=a.options.width||f.width||p;let h=a.options.height||f.height||m;const q=D(d("object"===typeof g?g.radius:g||0,n),0,m/2);e.inverted&&(k=l-p,c=e.plotSizeY-b-m,n=a.options.height||f.height||p,h=a.options.width||f.width||m);a.dlOptions=C.getDLOptions({level:this.mapOptionsToLevel[a.level],optionsPoint:a.options});a.plotX=1;a.plotY=1;a.tooltipPos=e.inverted?[e.plotSizeY-c-h/2,e.plotSizeX-k-n/2]:[k+n/2,c+h/2];
a.shapeArgs={x:k,y:c,width:n,height:h,r:q,display:a.hasShape()?"":"none"}}else a.dlOptions={enabled:!1}}}C.defaultOptions=w(f.defaultOptions,k);g.compose(p,C);m(C.prototype,{animate:a.prototype.animate,createNode:g.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:p,searchPoint:b.noop});n.registerSeriesType("sankey",C);"";return C});n(b,"masters/modules/sankey.src.js",[],function(){})});
//# sourceMappingURL=sankey.js.map