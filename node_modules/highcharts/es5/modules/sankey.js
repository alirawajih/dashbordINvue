/*
 Highcharts JS v11.1.0 (2023-09-05)

 Sankey diagram module

 (c) 2010-2021 Torstein Honsi

 License: www.highcharts.com/license
*/
'use strict';(function(a){"object"===typeof module&&module.exports?(a["default"]=a,module.exports=a):"function"===typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(q){a(q);a.Highcharts=q;return a}):a("undefined"!==typeof Highcharts?Highcharts:void 0)})(function(a){function q(a,g,l,m){a.hasOwnProperty(g)||(a[g]=m.apply(null,l),"function"===typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:g,module:a[g]}})))}a=a?a._modules:
{};q(a,"Series/NodesComposition.js",[a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,g){a=a.series;var l=a.prototype,m=a.prototype.pointClass.prototype,y=g.defined,z=g.extend,f=g.find,e=g.merge,d=g.pick,b;(function(b){function c(){this.data=[].concat(this.points||[],this.nodes);return l.destroy.apply(this,arguments)}function a(){this.nodes&&(this.nodes.forEach(function(b){b.destroy()}),this.nodes.length=0);l.setData.apply(this,arguments)}function A(b){var e=arguments,d=this.isNode?
this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==b&&d.forEach(function(b){b&&b.series&&(m.setState.apply(b,e),b.isNode||(b.fromNode.graphic&&m.setState.apply(b.fromNode,e),b.toNode&&b.toNode.graphic&&m.setState.apply(b.toNode,e)))});m.setState.apply(this,e)}function r(b,c,a,k){var n=this,u=this.series.options.nodes,h=this.series.options.data,H=h&&h.length||0,I=h&&h[this.index];m.update.call(this,b,this.isNode?!1:c,a,k);this.isNode&&(b=(u||[]).reduce(function(h,b,e){return n.id===
b.id?e:h},-1),k=e(u&&u[b]||{},h&&h[this.index]||{}),h&&(I?h[this.index]=I:h.length=H),u?0<=b?u[b]=k:u.push(k):this.series.options.nodes=[k],d(c,!0)&&this.series.chart.redraw(a))}var p=[];b.compose=function(b,e){g.pushUnique(p,b)&&(b=b.prototype,b.setNodeState=A,b.setState=A,b.update=r);g.pushUnique(p,e)&&(b=e.prototype,b.destroy=c,b.setData=a);return e};b.createNode=function(b){function e(b,h){return f(b,function(b){return b.id===h})}var c=this.pointClass,k=e(this.nodes,b);if(!k){k=this.options.nodes&&
e(this.options.nodes,b);var a=(new c).init(this,z({className:"highcharts-node",isNode:!0,id:b,y:1},k));a.linksTo=[];a.linksFrom=[];a.getSum=function(){var b=0,h=0;a.linksTo.forEach(function(h){b+=h.weight||0});a.linksFrom.forEach(function(b){h+=b.weight||0});return Math.max(b,h)};a.offset=function(b,h){for(var e=0,d=0;d<a[h].length;d++){if(a[h][d]===b)return e;e+=a[h][d].weight}};a.hasShape=function(){var b=0;a.linksTo.forEach(function(h){h.outgoing&&b++});return!a.linksTo.length||b!==a.linksTo.length};
a.index=this.nodes.push(a)-1;k=a}k.formatPrefix="node";k.name=k.name||k.options.id||"";k.mass=d(k.options.mass,k.options.marker&&k.options.marker.radius,this.options.marker&&this.options.marker.radius,4);return k};b.destroy=c;b.generatePoints=function(){var b=this,e=this.chart,a={};l.generatePoints.call(this);this.nodes||(this.nodes=[]);this.colorCounter=0;this.nodes.forEach(function(b){b.linksFrom.length=0;b.linksTo.length=0;b.level=b.options.level});this.points.forEach(function(c){y(c.from)&&(a[c.from]||
(a[c.from]=b.createNode(c.from)),a[c.from].linksFrom.push(c),c.fromNode=a[c.from],e.styledMode?c.colorIndex=d(c.options.colorIndex,a[c.from].colorIndex):c.color=c.options.color||a[c.from].color);y(c.to)&&(a[c.to]||(a[c.to]=b.createNode(c.to)),a[c.to].linksTo.push(c),c.toNode=a[c.to]);c.name=c.name||c.id},this);this.nodeLookup=a};b.setNodeState=A;b.updateNode=r})(b||(b={}));return b});q(a,"Series/Sankey/SankeyPoint.js",[a["Core/Series/Point.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],
function(a,g,l){var m=this&&this.__extends||function(){function a(f,e){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])};return a(f,e)}return function(f,e){function d(){this.constructor=f}if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");a(f,e);f.prototype=null===e?Object.create(e):(d.prototype=e.prototype,
new d)}}(),y=l.defined;return function(g){function f(){var a=null!==g&&g.apply(this,arguments)||this;a.className=void 0;a.fromNode=void 0;a.level=void 0;a.linkBase=void 0;a.linkColorMode=void 0;a.linksFrom=void 0;a.linksTo=void 0;a.mass=void 0;a.nodeX=void 0;a.nodeY=void 0;a.options=void 0;a.series=void 0;a.toNode=void 0;return a}m(f,g);f.prototype.applyOptions=function(e,d){a.prototype.applyOptions.call(this,e,d);y(this.options.level)&&(this.options.column=this.column=this.options.level);return this};
f.prototype.getClassName=function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+a.prototype.getClassName.call(this)};f.prototype.getFromNode=function(){for(var a=-1,d,b=0;b<this.linksTo.length;b++){var c=this.linksTo[b];c.fromNode.column>a&&c.fromNode!==this&&(d=c.fromNode,a=d.column)}return{fromNode:d,fromColumn:a}};f.prototype.setNodeColumn=function(){y(this.options.column)||(this.column=0===this.linksTo.length?0:this.getFromNode().fromColumn+1)};f.prototype.isValid=function(){return this.isNode||
"number"===typeof this.weight};return f}(g.seriesTypes.column.prototype.pointClass)});q(a,"Series/Sankey/SankeySeriesDefaults.js",[],function(){"";return{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkColorMode:"from",linkOpacity:.5,opacity:1,minLinkWidth:0,nodeAlignment:"center",nodeWidth:20,nodePadding:10,
showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} \u2192 {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}});q(a,"Series/Sankey/SankeyColumnComposition.js",[a["Core/Utilities.js"]],function(a){var g=a.defined,l=a.relativeLength,m;(function(a){a.compose=
function(a,e){a.sankeyColumn=new m(a,e);return a};var m=function(){function a(a,d){this.points=a;this.series=d}a.prototype.getTranslationFactor=function(a){for(var d=this.points,b=d.slice(),c=a.options.minLinkWidth||0,e=0,g,f=(a.chart.plotSizeY||0)-(a.options.borderWidth||0)-(d.length-1)*a.nodePadding;d.length;){e=f/d.sankeyColumn.sum();a=!1;for(g=d.length;g--;)d[g].getSum()*e<c&&(d.splice(g,1),f=Math.max(0,f-c),a=!0);if(!a)break}d.length=0;b.forEach(function(b){d.push(b)});return e};a.prototype.top=
function(a){var d=this.series,b=d.nodePadding,c=this.points.reduce(function(c,e){0<c&&(c+=b);e=Math.max(e.getSum()*a,d.options.minLinkWidth||0);return c+e},0);return{top:0,center:.5,bottom:1}[d.options.nodeAlignment||"center"]*((d.chart.plotSizeY||0)-c)};a.prototype.left=function(a){var d=this.series,b=d.chart,c=d.options.equalNodes,e=b.inverted?b.plotHeight:b.plotWidth,g=d.nodePadding,f=this.points.reduce(function(b,f){0<b&&(b+=g);f=c?e/f.series.nodes.length-g:Math.max(f.getSum()*a,d.options.minLinkWidth||
0);return b+f},0);return((b.plotSizeX||0)-Math.round(f))/2};a.prototype.sum=function(){return this.points.reduce(function(a,d){return a+d.getSum()},0)};a.prototype.offset=function(a,d){var b=this.points,c=this.series,e=c.nodePadding,f=0;if(c.is("organization")&&a.hangsFrom)return{absoluteTop:a.hangsFrom.nodeY};for(var m=0;m<b.length;m++){var r=b[m].getSum();var p=Math.max(r*d,c.options.minLinkWidth||0),n=a.options[c.chart.inverted?"offsetHorizontal":"offsetVertical"],w=a.options.offset||0;r=r?p+e:
0;if(b[m]===a)return{relativeTop:f+(g(n)?l(n,p):l(w,r))};f+=r}};return a}();a.SankeyColumnAdditions=m})(m||(m={}));return m});q(a,"Series/TreeUtilities.js",[a["Core/Color/Color.js"],a["Core/Utilities.js"]],function(a,g){function l(b,a){var c=a.before,e=a.idRoot,f=a.mapIdToNode[e],g=a.points[b.i],p=g&&g.options||{},n=[],w=0;b.levelDynamic=b.level-(!1!==a.levelIsConstant?0:f.level);b.name=d(g&&g.name,"");b.visible=e===b.id||!0===a.visible;"function"===typeof c&&(b=c(b,a));b.children.forEach(function(c,
d){var e=m({},a);m(e,{index:d,siblings:b.children.length,visible:b.visible});c=l(c,e);n.push(c);c.visible&&(w+=c.val)});c=d(p.value,w);b.visible=0<=c&&(0<w||b.visible);b.children=n;b.childrenTotal=w;b.isLeaf=b.visible&&!w;b.val=c;return b}var m=g.extend,y=g.isArray,q=g.isNumber,f=g.isObject,e=g.merge,d=g.pick;return{getColor:function(b,c){var e=c.index,g=c.mapOptionsToLevel,f=c.parentColor,m=c.parentColorIndex,p=c.series,n=c.colors,w=c.siblings,l=p.points,k=p.chart.options.chart,x;if(b){l=l[b.i];
b=g[b.level]||{};if(g=l&&b.colorByPoint){var u=l.index%(n?n.length:k.colorCount);var h=n&&n[u]}if(!p.chart.styledMode){n=l&&l.options.color;k=b&&b.color;if(x=f)x=(x=b&&b.colorVariation)&&"brightness"===x.key&&e&&w?a.parse(f).brighten(e/w*x.to).get():f;x=d(n,k,h,x,p.color)}var H=d(l&&l.options.colorIndex,b&&b.colorIndex,u,m,c.colorIndex)}return{color:x,colorIndex:H}},getLevelOptions:function(a){var b={};if(f(a)){var g=q(a.from)?a.from:1;var m=a.levels;var l={};var r=f(a.defaults)?a.defaults:{};y(m)&&
(l=m.reduce(function(a,b){if(f(b)&&q(b.level)){var c=e({},b);var m=d(c.levelIsConstant,r.levelIsConstant);delete c.levelIsConstant;delete c.level;b=b.level+(m?0:g-1);f(a[b])?e(!0,a[b],c):a[b]=c}return a},{}));m=q(a.to)?a.to:1;for(a=0;a<=m;a++)b[a]=e({},r,f(l[a])?l[a]:{})}return b},setTreeValues:l,updateRootId:function(a){if(f(a)){var b=f(a.options)?a.options:{};b=d(a.rootNode,b.rootId,"");f(a.userOptions)&&(a.userOptions.rootId=b);a.rootNode=b}return b}}});q(a,"Series/Sankey/SankeySeries.js",[a["Core/Globals.js"],
a["Series/NodesComposition.js"],a["Series/Sankey/SankeyPoint.js"],a["Series/Sankey/SankeySeriesDefaults.js"],a["Core/Series/SeriesRegistry.js"],a["Series/Sankey/SankeyColumnComposition.js"],a["Core/Color/Color.js"],a["Series/TreeUtilities.js"],a["Core/Utilities.js"]],function(a,g,l,m,q,z,f,e,d){var b=this&&this.__extends||function(){function a(b,h){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var h in b)Object.prototype.hasOwnProperty.call(b,
h)&&(a[h]=b[h])};return a(b,h)}return function(b,h){function c(){this.constructor=b}if("function"!==typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");a(b,h);b.prototype=null===h?Object.create(h):(c.prototype=h.prototype,new c)}}(),c=q.series,v=q.seriesTypes.column,y=f.parse,A=e.getLevelOptions,r=d.clamp;e=d.extend;var p=d.isObject,n=d.merge,w=d.pick,C=d.relativeLength,k=d.stableSort;d=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||
this;b.colDistance=void 0;b.data=void 0;b.group=void 0;b.nodeLookup=void 0;b.nodePadding=void 0;b.nodes=void 0;b.nodeWidth=void 0;b.options=void 0;b.points=void 0;b.translationFactor=void 0;return b}b(c,a);c.getDLOptions=function(a){var b=p(a.optionsPoint)?a.optionsPoint.dataLabels:{};a=p(a.level)?a.level.dataLabels:{};return n({style:{}},a,b)};c.prototype.createNodeColumns=function(){var a=[];this.nodes.forEach(function(b){b.setNodeColumn();a[b.column]||(a[b.column]=z.compose([],this));a[b.column].push(b)},
this);for(var b=0;b<a.length;b++)"undefined"===typeof a[b]&&(a[b]=z.compose([],this));return a};c.prototype.order=function(a,b){var h=this;"undefined"===typeof a.level&&(a.level=b,a.linksFrom.forEach(function(a){a.toNode&&h.order(a.toNode,b+1)}))};c.prototype.generatePoints=function(){g.generatePoints.apply(this,arguments);var a=this;this.orderNodes&&(this.nodes.filter(function(a){return 0===a.linksTo.length}).forEach(function(b){a.order(b,0)}),k(this.nodes,function(a,b){return a.level-b.level}))};
c.prototype.getNodePadding=function(){var a=this.options.nodePadding||0;if(this.nodeColumns){var b=this.nodeColumns.reduce(function(a,b){return Math.max(a,b.length)},0);b*a>this.chart.plotSizeY&&(a=this.chart.plotSizeY/b)}return a};c.prototype.hasData=function(){return!!this.processedXData.length};c.prototype.pointAttribs=function(a,b){if(!a)return{};var c=this,h=c.mapOptionsToLevel[(a.isNode?a.level:a.fromNode.level)||0]||{},e=a.options,d=h.states&&h.states[b||""]||{};b=["colorByPoint","borderColor",
"borderWidth","linkOpacity","opacity"].reduce(function(a,b){a[b]=w(d[b],e[b],h[b],c.options[b]);return a},{});var g=w(d.color,e.color,b.colorByPoint?a.color:h.color);return a.isNode?{fill:g,stroke:b.borderColor,"stroke-width":b.borderWidth,opacity:b.opacity}:{fill:f.parse(g).setOpacity(b.linkOpacity).get()}};c.prototype.drawTracker=function(){v.prototype.drawTracker.call(this,this.points);v.prototype.drawTracker.call(this,this.nodes)};c.prototype.drawPoints=function(){v.prototype.drawPoints.call(this,
this.points);v.prototype.drawPoints.call(this,this.nodes)};c.prototype.drawDataLabels=function(){v.prototype.drawDataLabels.call(this,this.points);v.prototype.drawDataLabels.call(this,this.nodes)};c.prototype.translate=function(){this.processedXData||this.processData();this.generatePoints();this.nodeColumns=this.createNodeColumns();this.nodeWidth=C(this.options.nodeWidth,this.chart.plotSizeX);var a=this,b=this.chart,c=this.options,e=this.nodeWidth,d=this.nodeColumns;this.nodePadding=this.getNodePadding();
this.translationFactor=d.reduce(function(b,c){return Math.min(b,c.sankeyColumn.getTranslationFactor(a))},Infinity);this.colDistance=(b.plotSizeX-e-c.borderWidth)/Math.max(1,d.length-1);a.mapOptionsToLevel=A({from:1,levels:c.levels,to:d.length-1,defaults:{borderColor:c.borderColor,borderRadius:c.borderRadius,borderWidth:c.borderWidth,color:a.color,colorByPoint:c.colorByPoint,levelIsConstant:!0,linkColor:c.linkColor,linkLineWidth:c.linkLineWidth,linkOpacity:c.linkOpacity,states:c.states}});d.forEach(function(b){b.forEach(function(c){a.translateNode(c,
b)})},this);this.nodes.forEach(function(b){b.linksFrom.forEach(function(b){(b.weight||b.isNull)&&b.to&&(a.translateLink(b),b.allowShadow=!1)})})};c.prototype.translateLink=function(a){function b(b,c){c=b.offset(a,c)*g;return Math.min(b.nodeY+c,b.nodeY+(b.shapeArgs&&b.shapeArgs.height||0)-t)}var c=a.fromNode,d=a.toNode,e=this.chart,h=e.inverted,g=this.translationFactor,f=this.options,m=w(a.linkColorMode,f.linkColorMode),l=(e.inverted?-this.colDistance:this.colDistance)*f.curveFactor;f=c.nodeX;var k=
d.nodeX,q=a.outgoing,t=Math.max(a.weight*g,this.options.minLinkWidth),n=b(c,"linksFrom"),p=b(d,"linksTo"),r=this.nodeWidth,u=k>f+r;e.inverted&&(n=e.plotSizeY-n,p=(e.plotSizeY||0)-p,r=-r,t=-t,u=f>k);a.shapeType="path";a.linkBase=[n,n+t,p,p+t];if(u&&"number"===typeof p)a.shapeArgs={d:[["M",f+r,n],["C",f+r+l,n,k-l,p,k,p],["L",k+(q?r:0),p+t/2],["L",k,p+t],["C",k-l,p+t,f+r+l,n+t,f+r,n+t],["Z"]]};else if("number"===typeof p){l=k-20-t;q=k-20;u=f+r;var v=u+20,x=v+t,A=n,D=n+t,z=D+20,E=z+(e.plotHeight-n-t),
B=E+20,G=B+t,C=p,F=C+t,J=F+20,K=B+.7*t,L=k-.7*t,M=u+.7*t;a.shapeArgs={d:[["M",u,A],["C",M,A,x,D-.7*t,x,z],["L",x,E],["C",x,K,M,G,u,G],["L",k,G],["C",L,G,l,K,l,E],["L",l,J],["C",l,F-.7*t,L,C,k,C],["L",k,F],["C",q,F,q,F,q,J],["L",q,E],["C",q,B,q,B,k,B],["L",u,B],["C",v,B,v,B,v,E],["L",v,z],["C",v,D,v,D,u,D],["Z"]]}}a.dlBox={x:f+(k-f+r)/2,y:n+(p-n)/2,height:t,width:0};a.tooltipPos=e.inverted?[e.plotSizeY-a.dlBox.y-t/2,e.plotSizeX-a.dlBox.x]:[a.dlBox.x,a.dlBox.y+t/2];a.y=a.plotY=1;a.x=a.plotX=1;a.options.color||
("from"===m?a.color=c.color:"to"===m?a.color=d.color:"gradient"===m&&(c=y(c.color).get(),d=y(d.color).get(),a.color={linearGradient:{x1:1,x2:0,y1:0,y2:0},stops:[[0,h?c:d],[1,h?d:c]]}))};c.prototype.translateNode=function(a,b){var d=this.translationFactor,e=this.chart,f=this.options,g=f.borderRadius,h=f.borderWidth,k=void 0===h?0:h,l=a.getSum();h=Math.max(Math.round(l*d),this.options.minLinkWidth);var m=Math.round(this.nodeWidth),n=Math.round(k)%2/2,p=b.sankeyColumn.offset(a,d);b=Math.floor(w(p.absoluteTop,
b.sankeyColumn.top(d)+p.relativeTop))+n;d=Math.floor(this.colDistance*a.column+k/2)+C(a.options[e.inverted?"offsetVertical":"offsetHorizontal"]||0,m)+n;d=e.inverted?e.plotSizeX-d:d;(a.sum=l)?(a.shapeType="roundedRect",a.nodeX=d,a.nodeY=b,l=d,k=b,n=a.options.width||f.width||m,p=a.options.height||f.height||h,g=r(C("object"===typeof g?g.radius:g||0,n),0,h/2),e.inverted&&(l=d-m,k=e.plotSizeY-b-h,n=a.options.height||f.height||m,p=a.options.width||f.width||h),a.dlOptions=c.getDLOptions({level:this.mapOptionsToLevel[a.level],
optionsPoint:a.options}),a.plotX=1,a.plotY=1,a.tooltipPos=e.inverted?[e.plotSizeY-k-p/2,e.plotSizeX-l-n/2]:[l+n/2,k+p/2],a.shapeArgs={x:l,y:k,width:n,height:p,r:g,display:a.hasShape()?"":"none"}):a.dlOptions={enabled:!1}};c.defaultOptions=n(v.defaultOptions,m);return c}(v);g.compose(l,d);e(d.prototype,{animate:c.prototype.animate,createNode:g.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:l,searchPoint:a.noop});q.registerSeriesType("sankey",
d);"";return d});q(a,"masters/modules/sankey.src.js",[],function(){})});
//# sourceMappingURL=sankey.js.map